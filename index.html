<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ComfyUI Launcher</title>
  <link rel="stylesheet" href="renderer/styles.css">
</head>
<body>
  <div class="app-header">
    <h1>ComfyUI Launcher</h1>
    <button id="btn-settings" class="icon-btn" title="Settings">⚙</button>
  </div>

  <!-- Instance List View -->
  <div id="view-list" class="view active">
    <div id="update-banner" class="update-banner" style="display:none"></div>
    <div class="toolbar">
      <h2>Installations</h2>
      <div class="toolbar-actions">
        <button id="btn-track">Track Existing</button>
        <button class="primary" id="btn-new">+ New Install</button>
      </div>
    </div>
    <div id="instance-list" class="instance-list"></div>
  </div>

  <!-- New Install View -->
  <div id="view-new" class="view">
    <div class="toolbar">
      <h2>New Installation</h2>
      <button id="btn-new-back">← Back</button>
    </div>

    <div id="detected-gpu" class="detected-hardware"></div>

    <div class="field">
      <label for="inst-name">Name</label>
      <input type="text" id="inst-name" placeholder="e.g. ComfyUI Main">
    </div>

    <div class="field">
      <label for="source">Install Method</label>
      <select id="source" disabled><option>Loading…</option></select>
    </div>

    <div id="source-fields"></div>

    <div class="field">
      <label for="inst-path">Install Location</label>
      <div class="path-input">
        <input type="text" id="inst-path" placeholder="Loading…" readonly>
        <button id="btn-browse" type="button">Browse…</button>
      </div>
    </div>

    <div class="form-actions">
      <button class="primary" id="btn-save" disabled>Add Installation</button>
    </div>
  </div>

  <!-- Progress View -->
  <div id="view-progress" class="view">
    <div class="toolbar">
      <h2 id="progress-title">Working…</h2>
      <div class="toolbar-actions">
        <button class="danger" id="btn-progress-cancel" style="display:none">Cancel</button>
      </div>
    </div>
    <div id="progress-content"></div>
  </div>

  <!-- Instance Detail View -->
  <div id="view-detail" class="view">
    <div class="toolbar">
      <h2 id="detail-title"></h2>
      <button id="btn-detail-back">← Back</button>
    </div>
    <div id="detail-sections"></div>
  </div>

  <!-- Track Existing View -->
  <div id="view-track" class="view">
    <div class="toolbar">
      <h2>Track Existing Installation</h2>
      <button id="btn-track-back">← Back</button>
    </div>

    <div class="field">
      <label for="track-path">Installation Directory</label>
      <div class="path-input">
        <input type="text" id="track-path" placeholder="Select a directory…" readonly>
        <button id="btn-track-browse" type="button">Browse…</button>
      </div>
    </div>

    <div class="field">
      <label for="track-source">Detected Type</label>
      <select id="track-source" disabled><option>Browse to a directory first</option></select>
    </div>

    <div class="field">
      <label for="track-name">Name</label>
      <input type="text" id="track-name" placeholder="e.g. ComfyUI Main">
    </div>

    <div id="track-detail"></div>

    <div class="form-actions">
      <button class="primary" id="btn-track-save" disabled>Track Installation</button>
    </div>
  </div>

  <!-- Console View -->
  <div id="view-console" class="view">
    <div class="toolbar">
      <h2 id="console-title">ComfyUI Console</h2>
      <div class="toolbar-actions">
        <button id="btn-console-browser">Open in Browser</button>
        <button class="danger" id="btn-console-stop">Stop</button>
      </div>
    </div>
    <div class="terminal-output" id="console-terminal"></div>
  </div>

  <!-- Settings View -->
  <div id="view-settings" class="view">
    <div class="toolbar">
      <h2>Settings</h2>
      <button id="btn-settings-back">← Back</button>
    </div>
    <div id="settings-sections"></div>
  </div>

  <script src="renderer/util.js"></script>
  <script src="renderer/modal.js"></script>
  <script src="renderer/list.js"></script>
  <script src="renderer/detail.js"></script>
  <script src="renderer/new-install.js"></script>
  <script src="renderer/progress.js"></script>
  <script src="renderer/console.js"></script>
  <script src="renderer/settings.js"></script>
  <script src="renderer/track.js"></script>
  <script src="renderer/update-banner.js"></script>
  <script>
    window.api.getResolvedTheme().then((t) => window.Launcher.applyTheme(t));
    window.api.onThemeChanged((t) => window.Launcher.applyTheme(t));
    window.Launcher.detail.init();
    window.Launcher.newInstall.init();
    window.Launcher.settings.init();
    window.Launcher.track.init();
    window.Launcher.updateBanner.init();
    document.getElementById("btn-settings").onclick = () => window.Launcher.settings.show();
    window.Launcher.list.render();
  </script>
</body>
</html>
